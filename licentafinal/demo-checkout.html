<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Checkout - Gusturi Românești</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="bi bi-basket-fill me-2"></i>Gusturi Românești
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>DEMO MODE</strong> - Simulare checkout
                </span>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8">
                <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Mod demonstrație:</strong> Aceasta este o simulare vizuală. Nu vor fi plasate comenzi reale.
                </div>

                <h2>Finalizare Comandă (Demo)</h2>

                <form id="demo-checkout-form">
                    <!-- Address Selection -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-truck me-2"></i>Adresa de Livrare</h5>
                        </div>
                        <div class="card-body">
                            <!-- Address Options -->
                            <div class="mb-3">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="radio" name="address_option" id="existing_address" value="existing" checked>
                                    <label class="form-check-label" for="existing_address">
                                        <strong>Utilizează adresa existentă</strong>
                                    </label>
                                </div>

                                <!-- Existing Address Display -->
                                <div id="existing_address_display" class="ps-4 mb-3">
                                    <div class="border rounded p-3 bg-light">
                                        <strong>Ion Popescu</strong><br>
                                        Strada Florilor, nr. 15, bl. A2, ap. 23<br>
                                        București, Sector 3, 032145<br>
                                        <small class="text-muted">Tel: +40 721 234 567</small>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="address_option" id="new_address" value="new">
                                    <label class="form-check-label" for="new_address">
                                        <strong>Adaugă adresă nouă</strong>
                                    </label>
                                </div>
                            </div>

                            <!-- New Address Form -->
                            <div id="new_address_form" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="nume_complet" class="form-label">Nume complet *</label>
                                        <input type="text" class="form-control" id="nume_complet" placeholder="ex: Ion Popescu">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="telefon" class="form-label">Telefon *</label>
                                        <input type="tel" class="form-control" id="telefon" placeholder="ex: +40 721 234 567">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <label for="adresa" class="form-label">Adresă *</label>
                                        <input type="text" class="form-control" id="adresa" placeholder="Strada, numărul, bloc, apartament">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="oras" class="form-label">Oraș *</label>
                                        <input type="text" class="form-control" id="oras" placeholder="ex: București">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="judet" class="form-label">Județ *</label>
                                        <input type="text" class="form-control" id="judet" placeholder="ex: Ilfov">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cod_postal" class="form-label">Cod Poștal *</label>
                                        <input type="text" class="form-control" id="cod_postal" placeholder="ex: 123456">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-credit-card me-2"></i>Metoda de Plată</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning mb-3">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Nota:</strong> Plata cu cardul nu este disponibilă momentan.
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="metoda_plata" id="ramburs" value="ramburs" checked>
                                <label class="form-check-label" for="ramburs">
                                    <i class="bi bi-cash me-2"></i>Plată ramburs (la livrare)
                                </label>
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="metoda_plata" id="transfer" value="transfer">
                                <label class="form-check-label" for="transfer">
                                    <i class="bi bi-bank me-2"></i>Transfer bancar
                                </label>
                            </div>

                            <!-- Bank Transfer Details -->
                            <div id="bank-details" class="mt-3" style="display: none;">
                                <div class="alert alert-info">
                                    <h6><i class="bi bi-bank me-2"></i>Detalii pentru transfer bancar (Demo):</h6>
                                    <p class="mb-1"><strong>Beneficiar:</strong> SC Gusturi Românești Demo SRL</p>
                                    <p class="mb-1"><strong>IBAN:</strong> RO49DEMO1B31007593840000</p>
                                    <p class="mb-1"><strong>Banca:</strong> Banca Demo Transilvania</p>
                                    <p class="mb-1"><strong>Cod SWIFT:</strong> DEMOROBU</p>
                                    <p class="mb-0"><strong>Mențiune obligatorie:</strong> Comandă Demo + numele dumneavoastră</p>
                                    <small class="text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Acestea sunt date demonstrative - nu efectuați plăți reale!
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Notes -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-chat-text me-2"></i>Observații</h5>
                        </div>
                        <div class="card-body">
                            <textarea class="form-control" id="observatii" rows="3" 
                                      placeholder="Observații speciale pentru comandă (opțional)"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <div class="col-lg-4">
                <!-- Demo Order Summary -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-receipt me-2"></i>Sumar Comandă (Demo)</h5>
                    </div>
                    <div class="card-body">
                        <!-- Cart Items -->
                        <div id="cart-items" class="mb-3">
                            <div class="text-center py-3">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                <small class="d-block mt-2">Se încarcă produsele...</small>
                            </div>
                        </div>

                        <hr>

                        <!-- Order Totals -->
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span id="subtotal-amount">0.00 RON</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Transport:</span>
                            <span id="shipping-amount">15.00 RON</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2" id="discount-row" style="display: none;">
                            <span>Reducere:</span>
                            <span id="discount-amount" class="text-success">-0.00 RON</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between fw-bold">
                            <span>Total:</span>
                            <span id="total-amount">15.00 RON</span>
                        </div>

                        <div class="alert alert-success mt-3" role="alert">
                            <small><i class="bi bi-truck"></i> Transport gratuit pentru comenzi peste 80 RON</small>
                        </div>

                        <button type="button" class="btn btn-danger w-100 mt-3" id="place-order-btn">
                            <i class="bi bi-check-circle me-2"></i>Plasează Comanda
                        </button>
                    </div>
                </div>

                <!-- Demo Notice -->
                <div class="card mt-4">
                    <div class="card-body text-center">
                        <i class="bi bi-info-circle text-info fs-3"></i>
                        <h6 class="mt-2">Mod Demonstrație</h6>
                        <p class="small text-muted mb-0">
                            Aceasta este o simulare vizuală. 
                            Nu vor fi procesate plăți sau comenzi reale.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-check-circle me-2"></i>Comandă Plasată (Demo)
                    </h5>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                    <h4 class="mt-3">Comanda a fost plasată cu succes!</h4>
                    <p class="text-muted">(simulare demo)</p>
                    <div class="alert alert-info mt-3">
                        <strong>Număr comandă:</strong> <span id="order-number">#DEMO-2024-001</span><br>
                        <strong>Valoare:</strong> <span id="order-total">81.98 RON</span><br>
                        <strong>Metoda de plată:</strong> <span id="selected-payment-method">Ramburs</span><br>
                        <strong>Status:</strong> <span class="text-success">Confirmată</span>
                    </div>
                    <div class="alert alert-success mt-2">
                        <small><i class="bi bi-envelope-check"></i> Email de confirmare trimis la adresa ta</small>
                    </div>
                    <p class="small text-muted">
                        În versiunea reală, ați primi un email de confirmare cu detaliile comenzii.
                    </p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                        <i class="bi bi-arrow-left me-2"></i>Înapoi la Magazine
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                        <i class="bi bi-arrow-clockwise me-2"></i>Demo din nou
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="demo-cart-integration.js"></script>
    <script>
        // Simulate realistic cart data
        let cartData = {
            items: [],
            subtotal: 0,
            shipping: 15.00,
            discount: 0,
            total: 0
        };

        // Load cart data on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadCartData();
            await loadUserData();
        });

        // Load realistic cart data using integration
        async function loadCartData() {
            const cartIntegration = new DemoCartIntegration();

            // Show realistic loading states
            const loadingStates = [
                'Se conectează la baza de date...',
                'Se încarcă coșul de cumpărături...',
                'Se verifică stocul produselor...',
                'Se calculează totalurile...'
            ];

            for (let i = 0; i < loadingStates.length; i++) {
                document.getElementById('cart-items').innerHTML = `
                    <div class="text-center py-3">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                        <small class="d-block mt-2">${loadingStates[i]}</small>
                    </div>
                `;
                await cartIntegration.simulateApiDelay(200, 600);
            }

            // Load realistic cart data
            cartData.items = await cartIntegration.loadRealisticCart();
            calculateTotals();
            displayCartItems();
        }

        // Load realistic user data
        async function loadUserData() {
            const cartIntegration = new DemoCartIntegration();

            // Try to get real user data first
            try {
                const response = await fetch('api/user.php?action=get_addresses');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.addresses && result.addresses.length > 0) {
                        // Use real addresses - would display them here
                        console.log('Using real user addresses');
                        return;
                    }
                }
            } catch (error) {
                console.log('Using demo user data');
            }

            // Generate realistic demo address
            const userData = cartIntegration.generateUserData();
            const existingAddress = document.getElementById('existing_address_display');

            existingAddress.innerHTML = `
                <div class="border rounded p-3 bg-light">
                    <strong>${userData.name}</strong><br>
                    ${userData.address}<br>
                    ${userData.city}, Sector ${userData.sector}, ${userData.postalCode}<br>
                    <small class="text-muted">Tel: ${userData.phone}</small>
                </div>
            `;
        }

        function calculateTotals() {
            cartData.subtotal = cartData.items.reduce((sum, item) => sum + (item.pret * item.cantitate), 0);

            // Free shipping over 150 RON
            cartData.shipping = cartData.subtotal >= 150 ? 0 : 15.00;

            // Random discount for demonstration
            if (cartData.subtotal > 100 && Math.random() > 0.7) {
                cartData.discount = Math.round(cartData.subtotal * 0.1 * 100) / 100; // 10% discount
                document.getElementById('discount-row').style.display = 'flex';
                document.getElementById('discount-amount').textContent = `-${cartData.discount.toFixed(2)} RON`;
            }

            cartData.total = cartData.subtotal + cartData.shipping - cartData.discount;

            // Update display
            document.getElementById('subtotal-amount').textContent = `${cartData.subtotal.toFixed(2)} RON`;
            document.getElementById('shipping-amount').textContent = cartData.shipping === 0 ? 'Gratuit' : `${cartData.shipping.toFixed(2)} RON`;
            document.getElementById('total-amount').textContent = `${cartData.total.toFixed(2)} RON`;

            // Update shipping notice
            const shippingNotice = document.querySelector('.alert-success');
            if (cartData.shipping === 0) {
                shippingNotice.innerHTML = '<small><i class="bi bi-check-circle"></i> Transport gratuit aplicat!</small>';
                shippingNotice.className = 'alert alert-success mt-3';
            } else {
                const remaining = (150 - cartData.subtotal).toFixed(2);
                shippingNotice.innerHTML = `<small><i class="bi bi-truck"></i> Încă ${remaining} RON pentru transport gratuit</small>`;
                shippingNotice.className = 'alert alert-info mt-3';
            }
        }

        function displayCartItems() {
            const container = document.getElementById('cart-items');

            if (cartData.items.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning text-center">
                        <i class="bi bi-cart-x"></i> Coșul este gol
                    </div>
                `;
                document.getElementById('place-order-btn').disabled = true;
                return;
            }

            let html = '';
            cartData.items.forEach(item => {
                const itemTotal = (item.pret * item.cantitate).toFixed(2);
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-2">
                        <div class="d-flex align-items-center">
                            <img src="${item.imagine}" alt="${item.nume}" class="me-2" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;">
                            <div>
                                <small class="fw-bold d-block">${item.nume}</small>
                                <small class="text-muted">${item.cantitate} x ${item.pret.toFixed(2)} RON</small>
                            </div>
                        </div>
                        <span class="fw-bold">${itemTotal} RON</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Address selection toggle
        document.querySelectorAll('input[name="address_option"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const newAddressForm = document.getElementById('new_address_form');
                const existingAddressDisplay = document.getElementById('existing_address_display');

                if (this.value === 'new') {
                    newAddressForm.style.display = 'block';
                    existingAddressDisplay.style.display = 'none';
                } else {
                    newAddressForm.style.display = 'none';
                    existingAddressDisplay.style.display = 'block';
                }
            });
        });

        // Payment method selection
        document.querySelectorAll('input[name="metoda_plata"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const bankDetails = document.getElementById('bank-details');
                if (this.value === 'transfer') {
                    bankDetails.style.display = 'block';
                } else {
                    bankDetails.style.display = 'none';
                }
            });
        });

        // Place order demo with realistic simulation
        document.getElementById('place-order-btn').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;

            // Validate form
            const selectedAddress = document.querySelector('input[name="address_option"]:checked');
            const selectedPayment = document.querySelector('input[name="metoda_plata"]:checked');

            if (selectedAddress.value === 'new') {
                const requiredFields = ['nume_complet', 'telefon', 'adresa', 'oras', 'judet', 'cod_postal'];
                for (let field of requiredFields) {
                    const input = document.getElementById(field);
                    if (!input.value.trim()) {
                        input.focus();
                        input.classList.add('is-invalid');
                        setTimeout(() => input.classList.remove('is-invalid'), 3000);
                        return;
                    }
                }
            }

            // Show realistic loading states
            btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Se validează datele...';
            btn.disabled = true;

            await new Promise(resolve => setTimeout(resolve, 800));

            btn.innerHTML = '<i class="bi bi-database me-2"></i>Se salvează în baza de date...';
            await new Promise(resolve => setTimeout(resolve, 1200));

            btn.innerHTML = '<i class="bi bi-envelope me-2"></i>Se trimite confirmarea...';
            await new Promise(resolve => setTimeout(resolve, 600));

            // Generate realistic order number
            const orderNumber = 'GR-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-' + Math.floor(Math.random() * 9000 + 1000);

            // Update modal with current order details
            const paymentText = selectedPayment.value === 'ramburs' ? 'Plată ramburs' : 'Transfer bancar';
            document.getElementById('selected-payment-method').textContent = paymentText;
            document.querySelector('#successModal .alert-info').innerHTML = `
                <strong>Număr comandă:</strong> ${orderNumber}<br>
                <strong>Valoare:</strong> ${cartData.total.toFixed(2)} RON<br>
                <strong>Metoda de plată:</strong> ${paymentText}<br>
                <strong>Status:</strong> Confirmată
            `;

            // Clear cart after successful order
            localStorage.removeItem('cart');

            btn.innerHTML = originalText;
            btn.disabled = false;

            // Show success modal
            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
        });

        // Add form validation effects
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        this.classList.add('is-valid');
                        this.classList.remove('is-invalid');
                    }
                });
            });
        });
    </script>

// Load cart items
        async function loadCartItems() {
            try {
                showLoading(true);

                // First try to get real cart data
                let cartItems = [];

                // Try localStorage first (for immediate feedback)
                const localCart = localStorage.getItem('cart');
                if (localCart && localCart !== '[]') {
                    cartItems = JSON.parse(localCart);
                } else {
                    // Try API if logged in
                    try {
                        const response = await fetch('api/cart.php?action=get_cart');
                        if (response.ok) {
                            const result = await response.json();
                            if (result.success && result.items && result.items.length > 0) {
                                cartItems = result.items.map(item => ({
                                    id: item.produs_id || item.id,
                                    nume: item.nume || item.name,
                                    pret: parseFloat(item.pret_curent || item.pret || item.price),
                                    cantitate: parseInt(item.cantitate || item.quantity || 1),
                                    imagine: item.imagine || item.image || 'img/placeholder.png'
                                }));
                            }
                        }
                    } catch (apiError) {
                        console.log('API not available, using demo data');
                    }
                }

                // If no real cart data, use demo data
                if (cartItems.length === 0) {
                    const demoIntegration = new DemoCartIntegration();
                    cartItems = await demoIntegration.loadRealisticCart();
                }

                displayCartItems(cartItems);
                showLoading(false);

            } catch (error) {
                console.error('Error loading cart:', error);
                showLoading(false);

                // Fallback to demo data
                const demoIntegration = new DemoCartIntegration();
                const cartItems = await demoIntegration.loadRealisticCart();
                displayCartItems(cartItems);
            }
        }
</body>
</html>